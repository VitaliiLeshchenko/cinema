{
	"info": {
		"_postman_id": "3d721197-fb05-4dbe-a73c-b7f08252fb12",
		"name": "004 Merge",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Merge processing",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {\r",
							"    const evaLibrary = pm.require('@eva-human/eva_library');\r",
							"    // оновлюю дату\r",
							"    evaLibrary.updateEnvironmentDate();\r",
							"    \r",
							"    var requestData = JSON.parse(pm.request.body.raw);\r",
							"    // визначаю ключ і host, і оновлюю тіло запиту\r",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);\r",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);\r",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));\r",
							"}\r",
							"\r",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "298804f1-cbd6-4928-b3bd-635374c23cd5",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"380996849456\",\n    \"contract_id\": \"3E8D8D58-31FE-480B-BE8C-557090BB7E68\",\n    \"buyer_id\": 70,\n    \"action\": \"merge\",\n    \"date\": \"2025-12-09 16:41:51.877\",\n    \"source\": \"processing\",\n    \"changes\": {\n        \"merge_contract_id\": \"61E391FD-3FF9-4FD2-BD43-866E1C716E1F\",\n        \"merge_buyer_id\": 71,\n        \"remaining_phone\": \"380504542054\",\n        \"merge_cards\": [\n            \"2910000344890\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge localhost",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {\r",
							"    const evaLibrary = pm.require('@eva-human/eva_library');\r",
							"    // оновлюю дату\r",
							"    evaLibrary.updateEnvironmentDate();\r",
							"    \r",
							"    var requestData = JSON.parse(pm.request.body.raw);\r",
							"    // визначаю ключ і host, і оновлюю тіло запиту\r",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);\r",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);\r",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));\r",
							"}\r",
							"\r",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "a2e2af45-47f3-431a-8819-a4030239a199",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"380968682513\",\n    \"contract_id\": \"4154113F-7A02-4315-AEEA-BC82217E90AB\",\n    \"buyer_id\": 43,\n    \"action\": \"merge\",\n    \"date\": \"2025-12-22 17:16:08.180\",\n    \"source\": \"processing\",\n    \"changes\": {\n        \"merge_contract_id\": \"581413C0-4593-4C10-8C4B-6EF4F43FE9DB\",\n        \"merge_buyer_id\": 44,\n        \"remaining_phone\": \"380999618683\",\n        \"merge_cards\": [\n            \"2910000321990\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge processing Copy 2",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {\r",
							"    const evaLibrary = pm.require('@eva-human/eva_library');\r",
							"    // оновлюю дату\r",
							"    evaLibrary.updateEnvironmentDate();\r",
							"    \r",
							"    var requestData = JSON.parse(pm.request.body.raw);\r",
							"    // визначаю ключ і host, і оновлюю тіло запиту\r",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);\r",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);\r",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));\r",
							"}\r",
							"\r",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "57e75c17-6b14-4156-93c7-2141b4f4478d",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"sign\": \"leshchenko\",\n    \"phone\": \"{{phoneTest}}\",\n    \"contract_id\": \"FEFE0000-0000-0000-0000-{{phoneTest}}\",\n    \"buyer_id\": \"{{testIndex}}\",\n    \"action\": \"merge\",\n    \"date\": \"{{date}}\",\n    \"source\": \"processing\",\n    \"changes\": {\n        \"merge_contract_id\": \"FEFE0000-0000-0000-0000-380000000548\",\n        \"merge_buyer_id\": -547,\n        \"merge_cards\": [\n            \"-547\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge два клієнти із затертими номерами телефонів",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {\r",
							"    const evaLibrary = pm.require('@eva-human/eva_library');\r",
							"    // оновлюю дату\r",
							"    evaLibrary.updateEnvironmentDate();\r",
							"    \r",
							"    var requestData = JSON.parse(pm.request.body.raw);\r",
							"    // визначаю ключ і host, і оновлюю тіло запиту\r",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);\r",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);\r",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));\r",
							"}\r",
							"\r",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "6e43d7d5-d5f1-441c-a41e-ffb8c9e06d4b",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"\",\n    \"contract_id\": \"B8C64FD5-B9F6-47A8-BAAE-E010649B0A6B\",\n    \"buyer_id\": 33,\n    \"action\": \"merge\",\n    \"date\": \"2025-11-03 11:29:19.960\",\n    \"source\": \"processing\",\n    \"changes\": {\n        \"merge_contract_id\": \"39845E9A-52B2-454A-86B1-4AA95CF39662\",\n        \"merge_buyer_id\": 34,\n        \"merge_cards\": [\n            \"2990000004000\",\n            \"2990000003997\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge invalid source",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {",
							"    const evaLibrary = pm.require('@eva-human/eva_library');",
							"    // оновлюю дату",
							"    evaLibrary.updateEnvironmentDate();",
							"    ",
							"    var requestData = JSON.parse(pm.request.body.raw);",
							"    // визначаю ключ і host, і оновлюю тіло запиту",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));",
							"}",
							"",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "b96b0c98-f7d0-46e0-9601-bd7d6defd8cb",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"38098747\",\n    \"contract_id\": \"013E3DAD-08CC-4336-A3A9-14E31E9911DA\",\n    \"buyer_id\": 1,\n    \"action\": \"merge\",\n    \"date\": \"{{date}}\",\n    \"source\": \"mobapp\",\n    \"changes\": {\n        \"merge_contract_id\": \"BB32FC12-2BF4-4CD0-A058-50C30180616E\",\n        \"merge_buyer_id\": 2,\n        \"merge_cards\": [\n            \"2910000344630\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge invalid date type",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {",
							"    const evaLibrary = pm.require('@eva-human/eva_library');",
							"    // оновлюю дату",
							"    evaLibrary.updateEnvironmentDate();",
							"    ",
							"    var requestData = JSON.parse(pm.request.body.raw);",
							"    // визначаю ключ і host, і оновлюю тіло запиту",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));",
							"}",
							"",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							"pm.test(\"Response status code is 200\", function () {\r",
							"    pm.expect(pm.response.code).to.equal(200);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response time is less than 300ms\", function () {\r",
							"    pm.expect(pm.response.responseTime).to.be.below(300);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response has the required fields: error and status\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData).to.have.all.keys('error', 'status');\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Error is an integer\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.error).to.be.a('number').and.to.satisfy(Number.isInteger, \"Error must be an integer\");\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Status is \\\"Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss\\\"\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.status).equal('Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss')\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "9f69a679-5643-4488-84df-901f1f38e94f",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"38098747\",\n    \"contract_id\": \"013E3DAD-08CC-4336-A3A9-14E31E9911DA\",\n    \"buyer_id\": 1,\n    \"action\": \"merge\",\n    \"date\": \"2025-09-15\",\n    \"source\": \"mobapp\",\n    \"changes\": {\n        \"merge_contract_id\": \"BB32FC12-2BF4-4CD0-A058-50C30180616E\",\n        \"merge_buyer_id\": 2,\n        \"merge_cards\": [\n            \"2910000344630\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		}
	]
}