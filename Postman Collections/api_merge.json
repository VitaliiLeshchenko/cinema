{
	"info": {
		"_postman_id": "3d721197-fb05-4dbe-a73c-b7f08252fb12",
		"name": "API Merge",
		"schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
	},
	"item": [
		{
			"name": "Merge processing",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {\r",
							"    const evaLibrary = pm.require('@eva-human/eva_library');\r",
							"    // оновлюю дату\r",
							"    evaLibrary.updateEnvironmentDate();\r",
							"    \r",
							"    var requestData = JSON.parse(pm.request.body.raw);\r",
							"    // визначаю ключ і host, і оновлюю тіло запиту\r",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);\r",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);\r",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));\r",
							"}\r",
							"\r",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "298804f1-cbd6-4928-b3bd-635374c23cd5",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"{{phoneTest}}\",\n    \"contract_id\": \"FEFE0000-0000-0000-0000-{{phoneTest}}\",\n    \"buyer_id\": 253,\n    \"action\": \"merge\",\n    \"date\": \"{{date}}\",\n    \"source\": \"processing\",\n    \"changes\": {\n        \"merge_contract_id\": \"FEFE0000-0000-0000-0000-380000000253\",\n        \"merge_buyer_id\": 253,\n        \"remaining_phone\": \"380000000253\",\n        \"merge_cards\": [\n            \"380000000253\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge invalid source",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {",
							"    const evaLibrary = pm.require('@eva-human/eva_library');",
							"    // оновлюю дату",
							"    evaLibrary.updateEnvironmentDate();",
							"    ",
							"    var requestData = JSON.parse(pm.request.body.raw);",
							"    // визначаю ключ і host, і оновлюю тіло запиту",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));",
							"}",
							"",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "b96b0c98-f7d0-46e0-9601-bd7d6defd8cb",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"38098747\",\n    \"contract_id\": \"013E3DAD-08CC-4336-A3A9-14E31E9911DA\",\n    \"buyer_id\": 1,\n    \"action\": \"merge\",\n    \"date\": \"{{date}}\",\n    \"source\": \"mobapp\",\n    \"changes\": {\n        \"merge_contract_id\": \"BB32FC12-2BF4-4CD0-A058-50C30180616E\",\n        \"merge_buyer_id\": 2,\n        \"merge_cards\": [\n            \"2910000344630\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge invalid date type",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							"async function main() {",
							"    const evaLibrary = pm.require('@eva-human/eva_library');",
							"    // оновлюю дату",
							"    evaLibrary.updateEnvironmentDate();",
							"    ",
							"    var requestData = JSON.parse(pm.request.body.raw);",
							"    // визначаю ключ і host, і оновлюю тіло запиту",
							"    key = evaLibrary.human2getSharedKeyAndSetHostToEnvironment(requestData[\"source\"]);",
							"    requestData[\"hash\"] = await evaLibrary.sha256Hex(requestData, key);",
							"    pm.request.body.update(JSON.stringify(requestData, null, 0));",
							"}",
							"",
							"main();"
						],
						"type": "text/javascript",
						"packages": {
							"@eva-human/eva_library": {
								"id": "01993cfe-6d3a-780c-861a-c9745b650b3b"
							}
						},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							"pm.test(\"Response status code is 200\", function () {\r",
							"    pm.expect(pm.response.code).to.equal(200);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response time is less than 300ms\", function () {\r",
							"    pm.expect(pm.response.responseTime).to.be.below(300);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response has the required fields: error and status\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData).to.have.all.keys('error', 'status');\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Error is an integer\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.error).to.be.a('number').and.to.satisfy(Number.isInteger, \"Error must be an integer\");\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Status is \\\"Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss\\\"\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.status).equal('Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss')\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "9f69a679-5643-4488-84df-901f1f38e94f",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"38098747\",\n    \"contract_id\": \"013E3DAD-08CC-4336-A3A9-14E31E9911DA\",\n    \"buyer_id\": 1,\n    \"action\": \"merge\",\n    \"date\": \"2025-09-15\",\n    \"source\": \"mobapp\",\n    \"changes\": {\n        \"merge_contract_id\": \"BB32FC12-2BF4-4CD0-A058-50C30180616E\",\n        \"merge_buyer_id\": 2,\n        \"merge_cards\": [\n            \"2910000344630\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		},
		{
			"name": "Merge hash is missing",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "eb894a3e-5b66-40f7-b317-28f887fd2d8e",
						"exec": [
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "c151578d-1534-4448-814e-05daa769623e",
						"exec": [
							"pm.test(\"Response status code is 200\", function () {\r",
							"    pm.expect(pm.response.code).to.equal(200);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response time is less than 300ms\", function () {\r",
							"    pm.expect(pm.response.responseTime).to.be.below(300);\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Response has the required fields: error and status\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData).to.have.all.keys('error', 'status');\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Error is an integer\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.error).to.be.a('number').and.to.satisfy(Number.isInteger, \"Error must be an integer\");\r",
							"});\r",
							"\r",
							"\r",
							"pm.test(\"Status is \\\"Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss\\\"\", function () {\r",
							"    const responseData = pm.response.json();\r",
							"    \r",
							"    pm.expect(responseData).to.be.an('object');\r",
							"    pm.expect(responseData.status).equal('Invalid date format. Expected YYYY-MM-DD HH:mm:ss.sss')\r",
							"});\r",
							""
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"id": "3e4354b3-7631-44f8-b364-eb359e0a9a56",
			"protocolProfileBehavior": {
				"disableBodyPruning": true
			},
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"phone\": \"38098747\",\n    \"contract_id\": \"013E3DAD-08CC-4336-A3A9-14E31E9911DA\",\n    \"buyer_id\": 1,\n    \"action\": \"merge\",\n    \"date\": \"2025-09-15\",\n    \"source\": \"mobapp\",\n    \"changes\": {\n        \"merge_contract_id\": \"BB32FC12-2BF4-4CD0-A058-50C30180616E\",\n        \"merge_buyer_id\": 2,\n        \"merge_cards\": [\n            \"2910000344630\"\n        ]\n    }\n}"
				},
				"url": "{{host}}/client"
			},
			"response": []
		}
	]
}